<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    
    <title>腾讯课堂WebRTC上麦和快直播实践 | 库洛洛Blog</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#3F51B5">
    
    
    <meta name="keywords" content="">
    <meta name="description" content="腾讯课堂WebRTC上麦和快直播实践背景2020年春节过后，因为疫情不仅大家无法上班，学生也无法走进学校上课。保障“停课不停学”，腾讯课堂迎来几百万同时在线上课学生的同时，在线教育部的研发同事们也迎来了巨大挑战。 在线教育的音视频上课场景，无外乎看重：低延迟、可互动。而这次还多了要支持庞大的同时在线数。 因此在上课高峰来临前，IMWeb音视频前端小分队的最优先两个任务是：  浏览器中直播上课，需要">
<meta property="og:type" content="article">
<meta property="og:title" content="腾讯课堂WebRTC上麦和快直播实践">
<meta property="og:url" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/index.html">
<meta property="og:site_name" content="库洛洛Blog">
<meta property="og:description" content="腾讯课堂WebRTC上麦和快直播实践背景2020年春节过后，因为疫情不仅大家无法上班，学生也无法走进学校上课。保障“停课不停学”，腾讯课堂迎来几百万同时在线上课学生的同时，在线教育部的研发同事们也迎来了巨大挑战。 在线教育的音视频上课场景，无外乎看重：低延迟、可互动。而这次还多了要支持庞大的同时在线数。 因此在上课高峰来临前，IMWeb音视频前端小分队的最优先两个任务是：  浏览器中直播上课，需要">
<meta property="og:locale" content="zn">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/img/2020-03-09-00-00-10.gif">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-09-00-00-10.gif">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-08-22-09-39.png">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-08-22-27-17.png">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/img/2020-03-10-00-14-18.png">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-10-00-14-18.png">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-09-13-12-14.png">
<meta property="og:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/2020-03-09-14-07-10.png">
<meta property="article:published_time" content="2020-03-08T09:30:07.000Z">
<meta property="article:modified_time" content="2020-03-22T08:53:39.319Z">
<meta property="article:author" content="Kuuroro Chan">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/img/2020-03-09-00-00-10.gif">
    
        <link rel="alternate" type="application/atom+xml" title="库洛洛Blog" href="/atom.xml">
    
    <link rel="shortcut icon" href="/favicon.ico">
    <link rel="stylesheet" href="//unpkg.com/hexo-theme-material-indigo@latest/css/style.css">
    <style>
        .post-content strong{
            color: #333!important
        }
        .img-lightbox img{
            max-width: 85%;
        }
        .post-content > .highlight, .post-content > .image-bubble, .post-content > pre{
            margin-left: 0;
            margin-right:0;
        }
    </style>
    <script>window.lazyScripts=[]</script>

    <!-- custom head -->
    

<meta name="generator" content="Hexo 4.2.0"></head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/avatar.png">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">Kuuroro Chan</h5>
          <span class="mail">个人&nbsp; </span> <a href="mailto:javenchen_sz@163.com" title="javenchen_sz@163.com" class="mail">javenchen_sz@163.com</a><br/>
          <span class="mail">腾讯&nbsp; </span> <a href="mailto:javenwwchen@tencent.com" title="javenwwchen@tencent.com" class="mail">javenwwchen@tencent.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                Archives
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                Tags
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                Categories
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/kuuroro" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">腾讯课堂WebRTC上麦和快直播实践</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="Search">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">腾讯课堂WebRTC上麦和快直播实践</h1>
        <h5 class="subtitle">
            
                <time datetime="2020-03-08T09:30:07.000Z" itemprop="datePublished" class="page-time">
  2020-03-08
</time>


            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap post-toc-shrink" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#腾讯课堂WebRTC上麦和快直播实践"><span class="post-toc-number">1.</span> <span class="post-toc-text">腾讯课堂WebRTC上麦和快直播实践</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#背景"><span class="post-toc-number">1.1.</span> <span class="post-toc-text">背景</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#浏览器端举手上麦"><span class="post-toc-number">1.2.</span> <span class="post-toc-text">浏览器端举手上麦</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#浏览器-getUserMedia-采集音视频"><span class="post-toc-number">1.2.1.</span> <span class="post-toc-text">浏览器 getUserMedia 采集音视频</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#获取流并添加流上行"><span class="post-toc-number">1.2.2.</span> <span class="post-toc-text">获取流并添加流上行</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#举手上麦的整体业务-SDK调用流程"><span class="post-toc-number">1.2.3.</span> <span class="post-toc-text">举手上麦的整体业务+SDK调用流程</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#快直播WebRTC接入"><span class="post-toc-number">1.3.</span> <span class="post-toc-text">快直播WebRTC接入</span></a><ol class="post-toc-child"><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#为什么是快直播"><span class="post-toc-number">1.3.1.</span> <span class="post-toc-text">为什么是快直播</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#快直播接入开发"><span class="post-toc-number">1.3.2.</span> <span class="post-toc-text">快直播接入开发</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#快直播整体流程"><span class="post-toc-number">1.3.3.</span> <span class="post-toc-text">快直播整体流程</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#快直播播放器改造"><span class="post-toc-number">1.3.4.</span> <span class="post-toc-text">快直播播放器改造</span></a></li><li class="post-toc-item post-toc-level-3"><a class="post-toc-link" href="#完善监控与上报"><span class="post-toc-number">1.3.5.</span> <span class="post-toc-text">完善监控与上报</span></a></li></ol></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#总结"><span class="post-toc-number">1.4.</span> <span class="post-toc-text">总结</span></a></li><li class="post-toc-item post-toc-level-2"><a class="post-toc-link" href="#写在最后"><span class="post-toc-number">1.5.</span> <span class="post-toc-text">写在最后</span></a></li></ol></li></ol>
        </nav>
    </aside>


<article id="post-腾讯课堂WebRTC上麦和快直播实践"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">腾讯课堂WebRTC上麦和快直播实践</h1>
        <div class="post-meta">
            <time class="post-time" title="2020-03-08 17:30:07" datetime="2020-03-08T09:30:07.000Z"  itemprop="datePublished">2020-03-08</time>

            


            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <h1 id="腾讯课堂WebRTC上麦和快直播实践"><a href="#腾讯课堂WebRTC上麦和快直播实践" class="headerlink" title="腾讯课堂WebRTC上麦和快直播实践"></a>腾讯课堂WebRTC上麦和快直播实践</h1><h2 id="背景"><a href="#背景" class="headerlink" title="背景"></a>背景</h2><p>2020年春节过后，因为疫情不仅大家无法上班，学生也无法走进学校上课。保障“停课不停学”，腾讯课堂迎来几百万同时在线上课学生的同时，在线教育部的研发同事们也迎来了巨大挑战。</p>
<p>在线教育的音视频上课场景，无外乎看重：<strong>低延迟</strong>、<strong>可互动</strong>。而这次还多了要支持庞大的同时在线数。</p>
<p>因此在上课高峰来临前，IMWeb音视频前端小分队的最优先两个任务是：</p>
<ul>
<li>浏览器中直播上课，需要支持 <strong>学生举手上麦</strong> 的能力，提升上课互动体验。</li>
<li>受限于互动直播WebRTC无法支持几十万同时在线数，需要接入<strong>快直播WebRTC</strong> 来保障Web端的上课高峰。</li>
</ul>
<h2 id="浏览器端举手上麦"><a href="#浏览器端举手上麦" class="headerlink" title="浏览器端举手上麦"></a>浏览器端举手上麦</h2><p>先展示最终效果如下（画面为老师分享桌面，方便同时展示老师和学生操作）：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./img/2020-03-09-00-00-10.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2020-03-09-00-00-10.gif" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>很简单：老师先发起举手，学生点击举手后等待老师点名，老师选择学生上台发言，最后学生就能和老师通话了。</p>
<p>对于前端而言，可能会认为类似上麦这种需求在APP/客户端实现的比较多，但在浏览器中能否实现会有两个主要疑问：</p>
<ul>
<li>主是浏览器有权限调用系统设备（麦克风）吗 ？</li>
<li>调用设备录音后，是如何将音频数据实时发送上行的？</li>
</ul>
<h3 id="浏览器-getUserMedia-采集音视频"><a href="#浏览器-getUserMedia-采集音视频" class="headerlink" title="浏览器 getUserMedia 采集音视频"></a>浏览器 getUserMedia 采集音视频</h3><p>其实目前大部分浏览器都支持调用系统硬件设备（如麦克风、摄像头）来进行音视频的录制。这就需要通过浏览器API  <code>navigator.mediaDevices.getUserMedia</code>，来拿到本地媒体流。以下WebRTC SDK相关代码：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2020-03-08-22-09-39.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>


<p>其中 参数 constraints 是约束，如只采集麦克风音频或摄像头视频，你可以这么设置：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mediaStreamContrains = &#123; </span><br><span class="line">    video: <span class="literal">true</span>, </span><br><span class="line">    audio: <span class="literal">true</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>又或者你可以进一步对采集做限制<br>音频：采样率、采样大小、音量、是否回音消除、是否自动降噪、是否自动增益</p>
<p>视频：分辨率宽高、帧率、宽高比、前置/后置摄像头等</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mediaStreamContrains = &#123;</span><br><span class="line">    video: &#123;</span><br><span class="line">        frameRate: &#123;<span class="attr">min</span>: <span class="number">15</span>&#125;,</span><br><span class="line">        width: &#123;<span class="attr">min</span>: <span class="number">640</span>, <span class="attr">ideal</span>: <span class="number">1280</span>&#125;,</span><br><span class="line">        height: &#123;<span class="attr">min</span>: <span class="number">360</span>, <span class="attr">ideal</span>: <span class="number">720</span>&#125;,</span><br><span class="line">        aspectRatio: <span class="number">16</span>/<span class="number">9</span></span><br><span class="line">    &#125;,</span><br><span class="line">    audio: &#123;</span><br><span class="line">        echoCancellation: <span class="literal">true</span>,</span><br><span class="line">        noiseSuppression: <span class="literal">true</span>,</span><br><span class="line">        autoGainControl: <span class="literal">true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>当然<code>navigator.mediaDevices.getUserMedia</code>并不保证能一定获取到媒体数据。和APP调用系统权限一样，浏览器器会弹出询问提示窗口来索取权限。</p>
<p><img src="2020-03-08-22-27-17.png" alt=""></p>
<p>异常情况包含以下几种：</p>
<ul>
<li>AbortError［中止错误］</li>
<li>NotAllowedError［拒绝错误］</li>
<li>NotFoundError［找不到错误］</li>
<li>NotReadableError［无法读取错误］</li>
<li>OverConstrainedError［无法满足要求错误］</li>
<li>SecurityError［安全错误］</li>
<li>TypeError［类型错误］没有设置Constraint</li>
</ul>
<p>因此可以对不同类型的错误做相应记录，并给予用户提示。</p>
<h3 id="获取流并添加流上行"><a href="#获取流并添加流上行" class="headerlink" title="获取流并添加流上行"></a>获取流并添加流上行</h3><p>因为学生上麦只需要音频，因此constraints将audio设为true即可，获取流后添加到<strong>上行的RTCPeerConnection</strong>中。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> constraints = &#123; <span class="attr">audio</span>:<span class="literal">true</span> &#125;</span><br><span class="line"></span><br><span class="line">navigator.mediaDevices.getUserMedia(constraints)</span><br><span class="line">.then(<span class="function"><span class="keyword">function</span>(<span class="params">mediaStream</span>) </span>&#123;</span><br><span class="line">    <span class="comment">//  senderConnection是上行的rtcpeerconnection</span></span><br><span class="line">  senderConnection.addStream(mediaStream)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">error</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//根据error给予错误提示</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>以上就是麦克风音频流如何上行的代码，但SDK前后前后内部逻辑更复杂些。</p>
<blockquote>
<p>你会疑问：平时听说的回音消除，网络差时防抖都不用处理吗？<br>是的没错！因为这些WebRTC浏览器底层做了很好的处理。前端开发者只需关注业务，直接调用即可。</p>
</blockquote>
<h3 id="举手上麦的整体业务-SDK调用流程"><a href="#举手上麦的整体业务-SDK调用流程" class="headerlink" title="举手上麦的整体业务+SDK调用流程"></a>举手上麦的整体业务+SDK调用流程</h3><p>在大房的互动直播中，最多只能支持6名学生同时上麦。在一个班级房间中，绝大部分学生的大部分时间都只是收看的，只有当老师允许举手时，学生才能举手并上台发言。</p>
<p>在获取腾讯云WebRTC签名进房时，还要对”只收看“和”要上台发言“的两部分学生，区分调整权限参数。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//抽象代码</span></span><br><span class="line"><span class="keyword">const</span> WEBRTCRIGHTFLAG = &#123;</span><br><span class="line">    ALL: <span class="number">255</span>, <span class="comment">// 所有权限，可以上行</span></span><br><span class="line">    WATCH: <span class="number">171</span>, <span class="comment">// 只能下行</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"> <span class="keyword">const</span> params = &#123;</span><br><span class="line">    sdk_appid: CLOUDSDKAPPID,</span><br><span class="line">    term_id: termId,</span><br><span class="line">    <span class="comment">// 判断只是收看，还是需要互动上麦</span></span><br><span class="line">    uint64_want_privilege_map: !<span class="keyword">this</span>.needGetAllRight ? WEBRTCRIGHTFLAG.WATCH : WEBRTCRIGHTFLAG.ALL,</span><br><span class="line">    platform: PLATFORM.WEB,</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> getSigUrl = <span class="string">`获取签名的CGI请求地址`</span>;</span><br><span class="line"></span><br><span class="line">keFetch(getSigUrl, &#123;</span><br><span class="line">    method: <span class="string">'GET'</span>,</span><br><span class="line">&#125;).then(<span class="function">(<span class="params">data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.handleSig(data.userSig)</span><br><span class="line">&#125;).catch(<span class="function">(<span class="params">err</span>) =&gt;</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>学生在不同阶段时根据当前需要，在获取UserSig时指定privilege_map参数。</p>
<p>最后结合举手业务流程和上麦的SDK调用流程，梳理总结出下面的流程图：</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="./img/2020-03-10-00-14-18.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2020-03-10-00-14-18.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>


<p>结合最前面的展示效果，可以看到在学生执行上麦逻辑时，浏览器会提示是否允许获取麦克风设备。允许后，学生执行音频上行到互动直播的WebRTC服务，老师下行便能接收到学生音频流。</p>
<h2 id="快直播WebRTC接入"><a href="#快直播WebRTC接入" class="headerlink" title="快直播WebRTC接入"></a>快直播WebRTC接入</h2><h3 id="为什么是快直播"><a href="#为什么是快直播" class="headerlink" title="为什么是快直播"></a>为什么是快直播</h3><p>首先需要说明的是，此处说的快直播和原本互动直播，在浏览器端都是使用WebRTC进行音视频实时通讯，只是背后音视频服务的传输链路有区别。</p>
<ul>
<li><strong>快直播WebRTC</strong>：通过流地址，经由腾讯云WebRTC Server,从腾讯云直播平台拉取直播流。并以WebRTC下发流。且信令服务无关房间逻辑。适合单流纯收看的场景。</li>
</ul>
<ul>
<li><strong>互动直播WebRTC</strong> ：通过签名userSig鉴权进房，包含房间业务逻辑，主播/观众模式，信令服务通知流状态更新变化，支持观众上麦。</li>
</ul>
<p>直接对比一下：</p>
<table>
<thead>
<tr>
<th>方案</th>
<th>房间逻辑</th>
<th>拉流方式</th>
<th>流更新</th>
<th>主辅路</th>
<th>支持上行</th>
</tr>
</thead>
<tbody><tr>
<td>快直播WebRTC</td>
<td>无：只用流地址</td>
<td>腾讯云直播平台拉流（目前只支持原流，不支持混流）</td>
<td>无：只通知当流增加/移除，需要业务层实现</td>
<td>无，需要拉两路流，且无法保证同步</td>
<td>不支持</td>
</tr>
<tr>
<td>互动WebRTC</td>
<td>有：通过签名鉴权进房</td>
<td>进房后自动下发</td>
<td>有，房间内信令通知</td>
<td>有主辅路，且同步</td>
<td>支持</td>
</tr>
</tbody></table>
<p>总体上来说，快直播只适合纯观看的场景，而互动直播WebRTC有房间逻辑，支持主辅路，上麦互动等等特性，相比之下更适合现有的在线教育场景。</p>
<p>但它的服务架构更复杂，受限于种种原因，目前互动直播的WebRTC还无法支持几十万同时在线。而降级方案CDN直播，虽然理论上支持无上限同时收看人数，但确做不到低延迟。</p>
<p>而快直播WebRTC可以支持几十万的低延时直播 ，并且还支持向上扩容。面对腾讯课堂迎来的上课高峰，<strong>Web端需要紧急接入快直播，并且改造成适合在线教育的场景</strong>。</p>
<h3 id="快直播接入开发"><a href="#快直播接入开发" class="headerlink" title="快直播接入开发"></a>快直播接入开发</h3><p>对于纯观看直播场景，快直播的接入并不复杂。可以参考文档<a href="https://cloud.webrtc.qq.com/doc/WebRTCLiveMan.html" target="_blank" rel="noopener">https://cloud.webrtc.qq.com/doc/WebRTCLiveMan.html</a></p>
<ol>
<li><p>向业务获取老师当前的主辅路流，并接受push通知，实时更新拉取。</p>
</li>
<li><p>前端快直播拉流：</p>
</li>
</ol>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// teacherStreamUrl为从业务后台拿的直播流地址</span></span><br><span class="line"><span class="keyword">const</span> teacherStreamUrl=<span class="string">'webrtc://keonline.liveplay.qq.com/live/42824_e705d155a676d5a52e34d2f438ae00d8?txSecret=9456af788e04feb6f89de5cfbc17f588&amp;txTime=158234289'</span></span><br><span class="line"></span><br><span class="line">TXWebRTCAPI.pullStream(teacherStreamUrl);</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>监听获取快直播流，并给到播放器播放</li>
</ol>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F; 流添加</span><br><span class="line">TXWebRTCAPI.on(&quot;onAddStream&quot;, (event)&#x3D;&gt;&#123;</span><br><span class="line">    const teacherStream &#x3D; e.stream</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; 流移除</span><br><span class="line">TXWebRTCAPI.on(&quot;onRemoveStream&quot;, (event)&#x3D;&gt;&#123;</span><br><span class="line">    const teacherStream &#x3D; e.stream;</span><br><span class="line">    const errorCode&#x3D;e.code</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="快直播整体流程"><a href="#快直播整体流程" class="headerlink" title="快直播整体流程"></a>快直播整体流程</h3><p>当然接入并不会这么简单，因为上课场景并不会单路流从头看到尾，在适配改造前，让我们看下快直播的整体流程。红色为web端快直播的相关流程，可以发现快直播兜兜转转还是从云直播平台拉流，那为什么不直接云直播平台拉流播放呢？</p>
<p>可以发现快直播本质是：<strong>（从云直播平台）拉取流，改用WebRTC形式下行到浏览器直播，目的就是为了更低的延时而已。（对比RTMP/FLV/HLS，WebRTC可以实现1秒内延时）</strong>。舍弃互动直播房间逻辑，只负责拉流推流，让快直播WebRTC向上扩容成为可能。</p>
<h3 id="快直播播放器改造"><a href="#快直播播放器改造" class="headerlink" title="快直播播放器改造"></a>快直播播放器改造</h3><p>由于上课场景并不会单路流从头看到尾，老师可能随时切换PPT、视频、摄像头，并且画中画两路流来也会回切换。</p>
<p>而原本的webrtc播放器只针对互动WebRTC设计，流的切换完全由云webrtc信令通知，播放器再做处理，业务层无需关注。</p>
<p>但是快直播的拉流需要业务Push通知，流地址也要从业务CGI获取，而拉流之后的成功和失败则由云的信令通知。</p>
<p>短时间内专门做一个快直播播放器并不现实，只能在原有播放器做<strong>增量适配改造</strong>。</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2020-03-09-13-12-14.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>

<p>改造思路：蓝色为新增。</p>
<ol>
<li>复用原本播放器 UI/Dom，初始化逻辑，以及流的封装封方法等。</li>
<li>原本互动WebRTC 流管理 和SDK相关逻辑保持不变。</li>
<li>新增快直播SDK调用，及快直播流管理：包含拉流后的流增加和流移除、多路流管理的主辅路关系映射等。</li>
<li>播放器原本接口不变，新增拉流和停止拉流的接口及事件抛出。</li>
</ol>
<p>流管理基于quickStreams对象，管理对象和主辅路的映射关系。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.quickStreams = &#123;</span><br><span class="line">    <span class="string">'42824_e705d155a676d5a52e34d2f438ae00d8'</span>:&#123;</span><br><span class="line">        streamUrl:<span class="string">'webrtc://keonline.liveplay.qq.com/live/42824_e705d155a676d5a52e34d2f438ae00d8?txSecret=9456af788e04feb6f89de5cfbc17f588&amp;txTime=158234289'</span>,<span class="comment">//流地址</span></span><br><span class="line">        type: <span class="string">'main'</span>,<span class="comment">//'main或vice，当前大小画面的映射标识'</span></span><br><span class="line">        stream: <span class="xml"><span class="tag">&lt;<span class="name">MediaStream</span>&gt;</span> //miedaStream</span></span><br><span class="line"><span class="xml">    &#125;,</span></span><br><span class="line"><span class="xml">&#125;;</span></span><br></pre></td></tr></table></figure>

<p>要注意下三点：</p>
<ul>
<li><p>第一点：由于播放器接收业务和云的两放信令控制，由于两者下发时机是有差异的，这就无法很难保证当前的流映射关系是正确的。因此要规定两端信令的控制范围： <strong>业务信令只控制流状态映射的更新</strong>，而<strong>云信令只控制流能否播放</strong></p>
</li>
<li><p>第二点：由于快直播sdk无法二次拉取相同的流。收到更新和拉流前，遍历quickStreams中流是否已经存，并检查流状态。<strong>如果存在切正常则无需重新拉流，只更新流的主辅路对大小画面的映射关系</strong>。</p>
</li>
<li><p>第三点：由于快直播多路流，通过多个PeerConnection传输（互动webrtc主辅路两路流只通过一个PeerConnection），因此会存在主辅路轻微不同步的问题。这时候<strong>音频应该以大画面为准，避免音画不同步</strong>。</p>
</li>
</ul>
<h3 id="完善监控与上报"><a href="#完善监控与上报" class="headerlink" title="完善监控与上报"></a>完善监控与上报</h3><p>这次接入快直播WebRTC，除了补充快直播的监控上报外，还对增强原本的监控逻辑。</p>
<ol>
<li>removeStream 异常监控<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">case 20004:&#x2F;&#x2F; 防盗链鉴权服务器内部错误，建议重试</span><br><span class="line">case 20005:&#x2F;&#x2F; 服务器内部错误，建议重试</span><br><span class="line">case 20009:&#x2F;&#x2F; 数据通道连接超时，出现该错误，业务可以提示用户网络异常，刷新重试</span><br><span class="line">case 20011:&#x2F;&#x2F; 流异常断开,可能是主播下播或者网络异常，建议重试重新拉流</span><br><span class="line">case 20012:&#x2F;&#x2F; 流结束</span><br><span class="line">case 20014:&#x2F;&#x2F; 防盗链鉴权失败</span><br><span class="line">case 20015:&#x2F;&#x2F; 客户端跟后台数据通道超时断开</span><br></pre></td></tr></table></figure></li>
<li>黑屏检测：当收到视频帧后，且未下课前。每秒检测黑屏情况，超出阀值做降级处理。检测方法如下：<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">setInterval(() &#x3D;&gt; &#123;</span><br><span class="line">    const mainVideo&#x3D;his.mainVideo.getDom()</span><br><span class="line">    if(mainVideo.srcObject &amp;&amp; mainVideo.srcObject.active &amp;&amp; mainVideo.readyState !&#x3D;&#x3D; 4)&#123;</span><br><span class="line">        &#x2F;&#x2F; 判断为黑屏</span><br><span class="line">    &#125;</span><br><span class="line">&#125;,1000)</span><br></pre></td></tr></table></figure></li>
<li>加入丢包率与卡顿率上报：SDK调用浏览getStats API获取WebRTC报告数据，对<code>packetLost</code>、<code>packetsReceived</code>、<code>interframeDelay</code>这些核心度量数据做收集。快直播SDK每2s抛出质量数据，但由于web侧几十万同时在线数，频繁上报带来会带较大大压力。因此基于质量数据做60s的前端合并计算后， 再进行上报。</li>
</ol>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="2020-03-09-14-07-10.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">type: &quot;stream_quality&quot;</span><br><span class="line">content:</span><br><span class="line">decInfo:</span><br><span class="line">streamid: &quot;42824_2b851a8b0e208fa8c5f0c129ed6daf43&quot;</span><br><span class="line">streamurl: &quot;webrtc:&#x2F;&#x2F;keonline.liveplay.qq.com&#x2F;live&#x2F;42824_2b851a8b0e208fa8c5f0c129ed6daf43?txSecret&#x3D;3e403590486c92f3f63e7293545c597d&amp;txTime&#x3D;1583733346&quot;</span><br><span class="line"></span><br><span class="line">audio:</span><br><span class="line">ssrc: &quot;16884383&quot;</span><br><span class="line">codec: &quot;opus&quot;</span><br><span class="line">packetsReceived: 104</span><br><span class="line">bytesReceived: 12424</span><br><span class="line">packetsLost: 0</span><br><span class="line"></span><br><span class="line">video:</span><br><span class="line">ssrc: &quot;33750382&quot;</span><br><span class="line">codec: &quot;H264&quot;</span><br><span class="line">packetsReceived: 29</span><br><span class="line">bytesReceived: 4279</span><br><span class="line">packetsLost: 0</span><br><span class="line">width: 1328</span><br><span class="line">height: 672</span><br><span class="line">framesDecoded: 13</span><br><span class="line">framesReceived: 14</span><br><span class="line">interFrameDelayMax: 136</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>虽然此次紧急需求在短短几天就完成开发并上线，但由于开发时间短，代码层面没有完全很好梳理：</p>
<ul>
<li><p>受限播放器原本的设计，只适用于互动WebRTC，这次采取增量改造方式来开发。互动WebRTC、快直播WebRTC、FLV、HLS直播间的切换都需要播放器层级的销毁与重载，应该还能再优化。</p>
</li>
<li><p>应对高峰课我们只能继续加很多监控点，但上报点分散，包袱越来越多，急需后续对Web端和H5端上报点做统一归拢，根据业务和端做上报的配置化，从而不必频繁多端改造播放器。</p>
</li>
</ul>
<p>在 “<strong>快速保障业务优先</strong>“ 的前提下，此次暴露了一些没有发现的问题，虽还掉了一些欠债，但原本播放器打补丁式的新增开发，也增添了些新债务。我们没法避免飞快的任务需求节奏，除了开发效率，也要保持所负责的代码时刻处于合理健康的状态，视角也要面向未来潜在的挑战。</p>
<p>小分队讨论接下来做一款设计更合理的，并且支持多种形式播放的<strong>Web直播播放器</strong>。目标是体验和质量更优、提升维护性和扩展性。</p>
<h2 id="写在最后"><a href="#写在最后" class="headerlink" title="写在最后"></a>写在最后</h2><p>对于音视频前端小分队而言，以上提到的只是小小一部分。在超哥带领下快速完成包括：协调扩容，流控降级策略，完善监控，日志排查，体验优化和改进，并同各位同事一起遇到问题就解决问题。</p>
<p>随着腾讯课堂PCU不断突破新高，仅Web浏览器端就有近60万的同时在线上课高峰。</p>
<p>最后特别提及 jayccchen 超哥、lizzydeng 邓雪，以及各位OED开发同学和腾讯云同事日以继日加班加点的付出，保证了此次腾讯课堂高峰课web端上课的音视频质量。</p>
<p>PS：<br> 如果有想同我们深入研究、共同探索 web 音视频的同学，欢迎加入我们 <strong>IMWeb 团队</strong>。在线教育部有许多音视频场景，期待你施展拳脚，感兴趣的同学可以直接联系我。</p>

        </div>

        <blockquote class="post-copyright">
    
    <div class="content">
        
<span class="post-time">
    Last updated: <time datetime="2020-03-22T08:53:39.319Z" itemprop="dateUpdated">2020-03-22 16:53:39</time>
</span><br>


        
    </div>
    
    <footer>
        <a href="http://kuuroro.com">
            <img src="/img/avatar.png" alt="Kuuroro Chan">
            Kuuroro Chan
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            

            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&title=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&pic=http://kuuroro.com/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&title=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&source=kuurorochan javenchen blog 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&via=http://kuuroro.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between flex-row-reverse">
  

  
    <div class="waves-block waves-effect next">
      <a href="/2020/01/25/hello-world/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Hello World</h4>
      </a>
    </div>
  
</nav>



    




















</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        感谢赞赏
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
        <label class="reward-toggle">
            <input id="rewardToggle" type="checkbox" class="reward-toggle-check"
                data-wechat="/img/wechat.jpg" data-alipay="/img/alipay.jpg">
            <div class="reward-toggle-ctrol">
                <span class="reward-toggle-item wechat">微信</span>
                <span class="reward-toggle-label"></span>
                <span class="reward-toggle-item alipay">支付宝</span>
            </div>
        </label>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        站点总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        站点总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            
            <span>This blog is licensed under a <a rel="license noopener" href="https://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a>.</span>
        </p>
    </div>
    <div class="bottom">
        <p><span>Kuuroro Chan &copy; 2015 - 2020</span>
            <span>
                
                <a href="http://www.miitbeian.gov.cn/" target="_blank">粤ICP备20010940号-1</a><br>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>
</footer>

    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&title=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&pic=http://kuuroro.com/img/avatar.png" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&title=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&source=kuurorochan javenchen blog 技术博客" data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《腾讯课堂WebRTC上麦和快直播实践》 — 库洛洛Blog&url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/&via=http://kuuroro.com" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://kuuroro.com/2020/03/08/%E8%85%BE%E8%AE%AF%E8%AF%BE%E5%A0%82WebRTC%E4%B8%8A%E9%BA%A6%E5%92%8C%E5%BF%AB%E7%9B%B4%E6%92%AD%E5%AE%9E%E8%B7%B5/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASYAAAEmCAAAAADqr2IGAAAEhUlEQVR42u3ay47aQBAF0Pz/TxMp2wyee6uMRMPxKiJD2z4s6vnnT3w9/l3JJ9efJ+ck38pP/v9/n512w4UJEyZMmN6S6XF55S+TgO4pk+9eQzx7nl9OwIQJEyZMhzPNjmvJrv8y/+TZXWY/W5IAYcKECROmb2DalJSzUja/2vCPCRMmTJgw5QlB/sl1AZy/av4zbEp6TJgwYcL0SUw5RNuQTTjyAL//2V7eC8eECRMmTG/GtAnJp//7hftNmDBhwoTpDZhmjdRZ8ZmPM2dLQrMnjN4aEyZMmDAdy5SstsxWc+4KyXlpPVvWKd4IEyZMmDAdy7RZ08kh8vOTe+V3bJObqCOOCRMmTJiOYkoGeLPh5SxdmI1CZ0V4kRhhwoQJE6YDmTat1f06Tpte5G3cpIzHhAkTJkzfwNS+Ul6ytmVqHuCv775pEEegmDBhwoTpKKZ22WU2sGzbu+0POSuS6/YuJkyYMGE6kGm2CpMXzG2zOIFol4HyROGXAhsTJkyYMB3IlIfhfet2tjqzearZStBqZQcTJkyYML0x06yY3A8jH4trU9bmb4cJEyZMmM5lmo39EohNe7cdnbaj2dn4FhMmTJgwnciUl5ebJu8sXWgbu20xXGzmYMKECROmw5mK3KFsy7bN3LYF3P7Mbdv3h3EmJkyYMGE6kKm9/SzotonCvll820ItJkyYMGE6nGnWTm1fOB8r5mF7s95aQGPChAkTpmOZohbnrZsteYt5dnKemrTLTJgwYcKE6USmu1Zb7grwswWge+/1w30xYcKECdOxTMlwsV3xSUrfvP3aFtLXf3NDmoIJEyZMmI5img0I24WbWfN3wzFr5j79FiZMmDBhOpZp1tidNVVf0X6djVqHaQ0mTJgwYTqQ6RWN13uL6lkBnFx5mxgTJkyYMJ3LtFmpmRFvhpF5mZqffJ00YMKECROm05naB0qK2+RB80dvU5OXDFAxYcKECdMHMeW94bsaqUnZmbd3kwBfl/GYMGHChOlYpjZUb0JvTjy7V/6t4cAVEyZMmDAdy9QWikkysUkC2rSgjdqblSBMmDBhwnQWUxKMN8nB7FXbJKBtKydNZEyYMGHC9ElMs/Zo20i997TZz9Cu72DChAkTpk9lugtuVri2qUCeLgzHrpgwYcKE6XCm2QpOcoM9elumtk+e3BETJkyYMH0SU3LQrNW7OTmnT1KNOinBhAkTJkyHM80Wcdp26gwuD+r79u7THxgTJkyYMH0E0yzEzorkPAWZFdXtKtIv74UJEyZMmI5lSoCuq782SLfEebBvh535fTFhwoQJ07lMj/LahPnkNe5a/ZmlDpgwYcKE6fOYNsVqMjLcJBztek07zpwlOpgwYcKE6USmtrxsC8vN+DMP9pv1oyjhwIQJEyZMhzPlR+dhe1Z2vi7taFMfTJgwYcL0bUyzYrjla4N9HuZvmPRiwoQJE6YvYJotfdYBeMGXl7XF02LChAkTpsOZZk3YfHy4CfB52H7Fcg8mTJgwYTqdaba400bMTSs5aRYn57crRPWFCRMmTJjei+kvoC1E9ZFHd8YAAAAASUVORK5CYII=" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/main.min.js"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="//unpkg.com/hexo-theme-material-indigo@latest/js/search.min.js" async></script>






<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'kuuroro hear！';
            clearTimeout(titleTime);
        } else {
            document.title = 'kuuroro';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
